# A/B-test calculator

## Вычисление размера выборки для A/B-теста: ABTestSampleSize

1. Задайте основные параметры теста при создании объекта ABTestSampleSize или используйте параметры по умолчанию:
   
   ```python
   from utils import ABTestSampleSize 
   obj = ABTestSampleSize()
   ```
   
2. Чтобы посмотреть подробную документацию класса ABTestSampleSize воспользуйтесь следующей функцией:

   ```python
   help(ABTestSampleSize)
   ```
   
4. В зависимости от применяемой в тесте метрики используйте один из следующих методов класса:
   - Среднее значение: get_sample_size_for_mean(mean, sigma) - задайте mean и sigma используя имеющиеся исторические данные:

     ```python
     obj.get_sample_size_for_mean(100, 30)
     ```
     > Замечание: некоторые источники рекомендуют использовать для оценки стандартного отклонения исторические данные взятые за промежуток времени равный длительности теста, однако здесь длительность теста зависит от sigma. В таком случае предлагается брать достаточно большую оценку сверху для длительности теста - несолько недель/месяцев
     
   - Конверсия: get_sample_size_for_conversion(conversion, is_em_calc) - задайте текущий уровень конверсии. По умолчанию используется методика расчета, позволяющая получать результаты близкие к результатам калькулятора evanmiller. Рекомендуется использовать альтернативную методику (is_em_calc=False) изложенную в Bernard Rosner, "Fundamentals of biostatistics", eq. 10.13

     ```python
     obj.get_sample_size_for_conversion(0.2)
     ```
     
5. Чтобы посмотреть результат вычисления, используйте вывод на консоль:

    ```python
    print(obj)
    ```

[Основная информация и ссылки](https://docs.google.com/presentation/d/1nlsR2e3tDegBUPVUJYsS5RrZ4n-Ac0qpj9M-boYFqZU/edit#slide=id.g2d18e0ae14b_0_1)

## Вычисление продолжительности A/B-теста: ABTestDuration

Идея оценки продолжительности теста основана на прогнозировании временного ряда (зависимости количества произошедших событий от времени),
построенного на основе исторических данных - модель ARIMA позволяет выполнить данный прогноз не имея ввиду знания о стационарности ряда.
Приведем пример временного ряда, построенного на основе запроса к базе данных:

   ```python
   query = '''
       select events_date as date, count(*) as amount
       from events
       group by events_date
   '''
   ```
> Замечание: ожидается, что отношение query будет иметь два и только два поля - date и amount (могут быть изменены посредством редактирования 
> констант ABTestDuration.DATE_COLOUMN и ABTestDuration.AMOUNT_COLOUMN соответственно)

Для осуществления запроса к базе данных вам потребуется создать ```config.py``` и заполнить его по шаблону ```config_template.py```.
Будьте осторожны, не добавляйте ваши данные в индекс, если собираетесь пушить коммит на гитхаб (не удаляйте ```config.py``` из ```.gitignore```).

1. Создайте объект класса ABTestDuration и передайте в него ваши параметры: query - временной ряд, который будет использован
для прогнозирования трафика событий; n - количество событий, требуемое A/B-тестом; season_cycle - количество событий в сезоне (
если 0 (по-умолчанию) - сезонность в данных отсутствует).

   ```python
   from utils import ABTestDuration 
   obj = ABTestDuration(query, n)
   ```

2. Чтобы посмотреть график прогноза возпользуйтесь методом show класса ABTestDuration:

   ```python
   obj.show()
   ```

3. Чтобы узнать, какое количество дней потребуется для проведения A/B-теста, используйте вывод на консоль:

   ```python
   print(obj)
   ```
